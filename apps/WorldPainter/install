#!/bin/bash

version=2.17.2

sudo rm -f /usr/share/fkms/applications/install4j_1tsntyi-worldpainter.desktop
install_packages openjdk-11-jre https://www.worldpainter.net/files/worldpainter_${version}.deb || exit 1

# remove worldpainter duplicate .desktop file due to bad deb
sudo xdg-desktop-menu uninstall --mode system "/opt/worldpainter/.install4j/install4j_1tsntyi-worldpainter.desktop"

# force java-11
case "$arch" in
  "64")
    echo /usr/lib/jvm/java-11-openjdk-arm64 | sudo tee /opt/worldpainter/.install4j/pref_jre.cfg >/dev/null
    ;;
  "32")
    echo /usr/lib/jvm/java-11-openjdk-armhf | sudo tee /opt/worldpainter/.install4j/pref_jre.cfg >/dev/null
    ;;
  *) error "Failed to detect OS CPU architecture! Something is very wrong." ;;
esac

#put the launcher in the Graphics category
echo 'Categories=Graphics;2DGraphics;RasterGraphics;' | sudo tee -a /usr/share/fkms/applications/install4j_1tsntyi-worldpainter.desktop
