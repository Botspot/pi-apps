#!/bin/bash

DIRECTORY="$(dirname "$(dirname "$( cd "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )")")"

function error {
  echo -e "\\e[91m$1\\e[39m"
  exit 1
}

reduceapt() { #remove unwanted lines from apt output
  grep -v "apt does not have a stable CLI interface.\|Reading package lists...\|Building dependency tree\|Reading state information...\|Need to get\|After this operation,\|Get:\|Fetched\|Selecting previously unselected package\|Preparing to unpack\|Unpacking \|Setting up \|Processing triggers for "
}

source "${DIRECTORY}/api" || error "failed to source ${DIRECTORY}/api"

if [ "$arch" == 64 ];then
  sudo apt purge sublime-text 2>&1 | reduceapt
elif [ "$arch" == 32 ];then
  rm -f ~/.local/share/applications/sublime-text.desktop
  rm -rf ~/"Sublime Text 2"
else
  error "Failed to detect OS CPU architecture! Something is very wrong."
fi

exit 0
