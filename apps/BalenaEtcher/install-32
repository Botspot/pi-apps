#!/bin/bash

DIRECTORY="$(dirname "$(dirname "$( cd "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )")")"

function error {
  echo -e "\\e[91m$1\\e[39m"
  exit 1
}

function download_latest_release_armhf() {
  echo "Downloading latest release..."
  curl -s https://api.github.com/repos/$1/releases/latest \
  | grep "browser_download_url.*armv7l.deb" \
  | cut -d : -f 2,3 \
  | tr -d \" \
  | wget -qi -
}

cd $HOME
rm -f ./balena-etcher-electron_*_armv7l.deb 2>/dev/null
download_latest_release_armhf Itai-Nelken/Etcher-arm-32-64
sudo apt install -y --fix-broken ~/balena-etcher-electron_*_armv7l.deb  || error "failed to install deb file!"
rm -f ~/balena-etcher-electron_*_armv7l.deb
exit 0
