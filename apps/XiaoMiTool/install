#!/bin/bash
install_packages openjfx adb android-tools-fastboot openjdk-11-jdk || exit 1

git_clone https://github.com/francescotescari/XiaoMiToolV2 -b linux || exit 1
cd XiaoMiToolV2
echo "Building XiaoMi Tool..."
./gradlew build || error "Failed to build XiaoMiToolV2!"

echo "Creating menu shortcut..."
echo "[Desktop Entry]
Name=XiaoMi Tool
Comment=XiaoMiTool is the all-in-one tool to make modding easy for everyone with a Xiaomi smartphone.
Exec=gksudo -k -u root /home/pi/XiaoMiToolV2/gradlew run
Icon=$(dirname "$0")/icon-64.png
Terminal=false
Type=Application
Categories=System" > ~/.local/share/applications/MiUnlocktool.desktop

echo "Creating execution script..."
echo "#!/bin/sh
$HOME/XiaoMiToolV2/gradlew run " | sudo tee /usr/local/bin/xiaomitool >/dev/null
sudo chmod +x /usr/local/bin/xiaomitool || error "Failed to make execution script executable."

